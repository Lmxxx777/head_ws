'''
东张西望
---------servo_control----------
[array('H'), array('H'), array('H', [90, 22]), array('H'), array('H'), array('H'), array('H'), array('H', [90, 22]), array('H'), array('H'), array('H'), array('H'), array('H'), array('H')]
[INFO] [1683617222.024445486] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [90, 22]), array('H', [66, 37]), array('H'), array('H'), array('H'), array('H', [70, 15]), array('H', [66, 37]), array('H'), array('H', [48, 37]), array('H', [37, 37]), array('H'), array('H')]
send to servo ok [255, 255, 254, 29, 131, 42, 4, 14, 31, 60, 0, 37, 22, 32, 138, 0, 15, 21, 31, 60, 0, 37, 43, 25, 43, 0, 37, 42, 13, 227, 0, 37, 110]
[INFO] [1683617222.295325017] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [102, 16]), array('H', [66, 37]), array('H'), array('H'), array('H'), array('H', [70, 15]), array('H', [66, 37]), array('H'), array('H', [48, 37]), array('H', [37, 37]), array('H'), array('H')]
send to servo ok [255, 255, 254, 9, 131, 42, 4, 13, 41, 83, 0, 16, 174]
[INFO] [1683617222.313992760] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [102, 16]), array('H', [66, 9]), array('H'), array('H'), array('H'), array('H', [70, 15]), array('H', [66, 9]), array('H'), array('H', [48, 37]), array('H', [37, 37]), array('H'), array('H')]
[INFO] [1683617222.458754378] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [102, 16]), array('H', [66, 9]), array('H'), array('H'), array('H'), array('H', [70, 15]), array('H', [66, 9]), array('H'), array('H', [48, 23]), array('H', [37, 23]), array('H'), array('H')]
[INFO] [1683617222.711638790] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [102, 16]), array('H', [102, 22]), array('H'), array('H'), array('H'), array('H', [70, 15]), array('H', [102, 22]), array('H'), array('H', [48, 23]), array('H', [37, 23]), array('H'), array('H')]
send to servo ok [255, 255, 254, 14, 131, 42, 4, 14, 42, 243, 0, 22, 21, 42, 243, 0, 22, 185]
[INFO] [1683617222.856478238] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [93, 46]), array('H', [102, 22]), array('H'), array('H'), array('H'), array('H', [70, 15]), array('H', [102, 22]), array('H'), array('H', [48, 23]), array('H', [37, 23]), array('H'), array('H')]
send to servo ok [255, 255, 254, 9, 131, 42, 4, 13, 38, 101, 0, 46, 129]
[INFO] [1683617223.145196415] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [93, 46]), array('H', [90, 22]), array('H'), array('H'), array('H'), array('H', [85, 53]), array('H', [90, 22]), array('H'), array('H', [56, 30]), array('H', [37, 23]), array('H'), array('H')]
send to servo ok [255, 255, 254, 24, 131, 42, 4, 14, 39, 12, 0, 22, 22, 37, 107, 0, 53, 21, 39, 12, 0, 22, 43, 28, 164, 0, 30, 159]
[INFO] [1683617223.255721617] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [93, 46]), array('H', [90, 22]), array('H'), array('H'), array('H'), array('H', [85, 53]), array('H', [90, 22]), array('H'), array('H', [56, 30]), array('H', [90, 32]), array('H'), array('H')]
send to servo ok [255, 255, 254, 9, 131, 42, 4, 42, 36, 227, 0, 32, 246]
[INFO] [1683617223.290778963] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [93, 46]), array('H', [116, 29]), array('H'), array('H'), array('H'), array('H', [85, 53]), array('H', [116, 29]), array('H'), array('H', [56, 30]), array('H', [90, 32]), array('H'), array('H')]
send to servo ok [255, 255, 254, 14, 131, 42, 4, 14, 47, 129, 0, 29, 21, 47, 129, 0, 29, 133]
[INFO] [1683617223.778594036] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [93, 46]), array('H', [116, 29]), array('H'), array('H'), array('H'), array('H', [85, 53]), array('H', [116, 29]), array('H'), array('H', [47, 30]), array('H', [90, 32]), array('H'), array('H')]
send to servo ok [255, 255, 254, 9, 131, 42, 4, 43, 24, 188, 0, 30, 42]
[INFO] [1683617223.796789770] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [93, 46]), array('H', [116, 29]), array('H'), array('H'), array('H'), array('H', [85, 53]), array('H', [116, 29]), array('H'), array('H', [47, 30]), array('H', [137, 29]), array('H'), array('H')]
send to servo ok [255, 255, 254, 9, 131, 42, 4, 42, 57, 73, 0, 29, 126]
[INFO] [1683617223.815448738] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [102, 38]), array('H', [116, 29]), array('H'), array('H'), array('H'), array('H', [85, 53]), array('H', [116, 29]), array('H'), array('H', [47, 30]), array('H', [137, 29]), array('H'), array('H')]
send to servo ok [255, 255, 254, 9, 131, 42, 4, 13, 41, 83, 0, 38, 152]
[INFO] [1683617223.833923312] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [102, 38]), array('H', [116, 29]), array('H'), array('H'), array('H'), array('H', [70, 39]), array('H', [116, 29]), array('H'), array('H', [47, 30]), array('H', [137, 29]), array('H'), array('H')]
send to servo ok [255, 255, 254, 9, 131, 42, 4, 22, 32, 138, 0, 39, 96]
[INFO] [1683617223.960847038] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [102, 38]), array('H', [116, 21]), array('H'), array('H'), array('H'), array('H', [70, 39]), array('H', [116, 21]), array('H'), array('H', [50, 20]), array('H', [137, 19]), array('H'), array('H')]
send to servo ok [255, 255, 254, 9, 131, 42, 4, 43, 26, 10, 0, 20, 228]
[INFO] [1683617224.159747754] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [89, 40]), array('H', [116, 21]), array('H'), array('H'), array('H'), array('H', [70, 39]), array('H', [116, 21]), array('H'), array('H', [50, 20]), array('H', [137, 19]), array('H'), array('H')]
send to servo ok [255, 255, 254, 9, 131, 42, 4, 13, 37, 24, 0, 40, 213]
[INFO] [1683617224.556500106] [facial_features]: call back
---------servo_control----------
[array('H'), array('H'), array('H', [89, 40]), array('H', [90, 28]), array('H'), array('H'), array('H'), array('H', [90, 39]), array('H', [90, 28]), array('H'), array('H', [90, 28]), array('H', [90, 28]), array('H'), array('H')]
send to servo ok [255, 255, 254, 29, 131, 42, 4, 14, 39, 12, 0, 28, 22, 39, 12, 0, 39, 21, 39, 12, 0, 28, 43, 43, 102, 0, 28, 42, 36, 227, 0, 28, 221]


'''

from xml_read import TimeTable
import matplotlib.pyplot as plt
from scipy.interpolate import interp1d
import numpy as np
# id : {"english_name":[[tim],[pos],[color]]}
nameE ={11 :{'left_blink'     :[[],[],[(1  ,0  ,0  )]] }, 
        12 :{'left_smile'     :[[],[],[(0  ,1  ,0  )]] }, 
        13 :{'left_eye_erect' :[[],[],[(0  ,0  ,1  )]] }, 
        14 :{'left_eye_level' :[[],[],[(1  ,1  ,0  )]] }, 
        44 :{'left_eyebrow'   :[[],[],[(0  ,1  ,1  )]] },
        24 :{'right_blink'    :[[],[],[(1  ,0  ,1  )]] }, 
        23 :{'right_smile'    :[[],[],[(0.5,0  ,0  )]] }, 
        22 :{'right_eye_erect':[[],[],[(0  ,0.5,0  )]] }, 
        21 :{'right_eye_level':[[],[],[(0  ,0  ,0.5)]] }, 
        31 :{'right_eyebrow'  :[[],[],[(0.5,0.5,0  )]] },
        43 :{'head_dian'      :[[],[],[(0  ,0.5,0.5)]] }, 
        42 :{'head_yao'       :[[],[],[(0.5,0  ,0.5)]] }, 
        33 :{'head_bai'       :[[],[],[(1  ,0.5,0  )]] },
        32 :{'mouth'          :[[],[],[(0  ,1  ,0.5)]] }}

def plt_data (data):
    plt_datas = nameE
    for tim, v1 in data.items():
        # plt_tim = Decimal(tim)*Decimal(0.02)
        plt_tim = (tim)*(0.02)
        # print(tim)
        for id, v2 in v1.items():
            plt_pos = v2['pos']
            plt_id = next(iter(plt_datas[id]))
            plt_datas[id][plt_id][0].append(plt_tim)
            plt_datas[id][plt_id][1].append(plt_pos)
    # print(plt_datas)
    return plt_datas
      

if __name__ == '__main__':

    test_action_path = "/moto/"
    test_action = '东张希望'
    # test_action_path = "/lan_control/"
    # test_action ="lan_GoPro1"
    # test_action = '初始'
    timeTable = TimeTable(acts_add = test_action_path)
    data = timeTable.Timetable(test_action)
    # print ("test timeTable", data)
    
    ## plt
    last_key = next(reversed(data))
    time_max = (last_key*0.02)*1.2
    print(last_key,"time_max",time_max)
    pos_max = 160
    plt_datas = plt_data(data) 

    fig, ax = plt.subplots()
    ax.set_xlim(0, time_max)
    ax.set_ylim(0, pos_max)
    ax.set_xlabel("tim")
    ax.set_ylabel("pos")

    for id_num, name_datas in plt_datas.items():
        name, datas_plt = next(iter(name_datas.items())) 
        tim_plt = datas_plt[0]
        pos_plt = datas_plt[1]
        color_plt = datas_plt[2][0]

        
        
        if len(tim_plt) != 0 : #  and id_num == 22
            # print(id_num)
            # print(name, tim_plt, pos_plt, color_plt)
            f = interp1d(tim_plt, pos_plt, kind= "cubic")
            new_tim_plt = np.linspace(min(tim_plt),max(tim_plt),num=1000)
            new_pos_plt = f(new_tim_plt)
            ax.plot(new_tim_plt,new_pos_plt,color = color_plt,label = name)
            # ax.plot(tim_plt,pos_plt,color = color_plt,label = name)
    ax.legend(loc = "upper right")
    plt.savefig('test.png')
    plt.show()




    